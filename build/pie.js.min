sudo.templateSettings={evaluate:/\[%([\s\S]+?)%\]/g,interpolate:/\[%=([\s\S]+?)%\]/g,escape:/\[%-([\s\S]+?)%\]/g},window.pie={array:{},date:{},dom:{},func:{},math:{},object:{},string:{},inheritance:{},mixins:{},services:{},uid:0,unique:function(){return this.uid++},util:{}},pie.array.areAll=function(t,e){for(var i=0;i<t.length;i++)if(!e.call(null,t[i]))return!1;return!0},pie.array.areAny=function(t,e){for(var i=0;i<t.length;i++)if(e.call(null,t[i]))return!0;return!1},pie.array.args=function(t){return Array.prototype.slice.call(t)},pie.array.avg=function(t){var e=pie.array.sum(t),i=t.length;return i?e/i:0},pie.array.compact=function(t,e){return t.filter(function(t){return e?!!t:null!=t})},pie.array.detect=function(t,e){for(var i=0,r=t.length;r>i;i++)if(pie.object.getValue(t[i],e))return t[i]},pie.array.dup=function(t){return t.slice(0)},pie.array.flatten=function(t,e,i){return i=i||[],Array.isArray(t)&&-1!==e?(null!=e&&e--,t.forEach(function(t){pie.array.flatten(t,e,i)})):i.push(t),i},pie.array.from=function(t){return Array.isArray(t)?t:pie.array.compact([t],!1)},pie.array.grep=function(t,e){return t.filter(function(t){return e.test(String(t))})},pie.array.groupBy=function(t,e){var i,r={};return t.forEach(function(t){i=pie.object.getValue(t,e),null!=i&&(r[i]=r[i]||[],r[i].push(t))}),r},pie.array.intersect=function(t,e){return t.filter(function(t){return~e.indexOf(t)})},pie.array.last=function(t){return t&&t.length?t[t.length-1]:void 0},pie.array.map=function(t,e,i){var r;return r="function"!=typeof e?function(t){var r=t[e];return i&&"function"==typeof r?r.apply(t):r}:e,t.map(function(t){return r(t)})},pie.array.remove=function(t,e){for(var i;~(i=t.indexOf(e));)t.splice(i,1);return t},pie.array.subtract=function(t,e){return t.filter(function(t){return!~e.indexOf(t)})},pie.array.sum=function(t){var e=0;return t.forEach(function(t){e+=parseFloat(t)}),e},pie.array.sortBy=function(t,e){var i,r;return t.sort(function(t,n){return i=pie.object.getValue(t,e),r=pie.object.getValue(n,e),i===r?0:r>i?-1:1})},pie.array.toSentence=function(t,e){if(!t.length)return"";var i=e&&e.t("sentence.delimeter",{"default":""})||", ",r=e&&e.t("sentence.and",{"default":""})||" and ";return t.length>2&&(t=[t.slice(0,t.length-1).join(i),t.slice(t.length-1)]),t.join(r)},pie.array.union=function(){var t=pie.array.args(arguments);return t=pie.array.compact(t,!0),t=pie.array.flatten(t),t=pie.array.unique(t)},pie.array.unique=function(t){return t.filter(function(e,i){return t.indexOf(e)===i})},pie.date.dateFromISO=function(t){if(!t)return null;var e=t.split(/T|\s/)[0].split("-");return new Date(e[0],e[1]-1,e[2])},pie.date.timeFromISO=function(){var t=[1,4,5,6,7,10,11];return function(e){if(!e)return 0/0;if(!/T|\s/.test(e))return pie.date.dateFromISO(e);var i,r,n=0;if(r=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(e)){for(var o,a=0;o=t[a];++a)r[o]=+r[o]||0;r[2]=(+r[2]||1)-1,r[3]=+r[3]||1,"Z"!==r[8]&&void 0!==r[9]&&(n=60*r[10]+r[11],"+"===r[9]&&(n=0-n)),i=Date.UTC(r[1],r[2],r[3],r[4],r[5]+n,r[6],r[7])}else i=0/0;return new Date(i)}}(),pie.dom.createElement=function(t){var e=document.createElement("div");return e.innerHTML=t,e.removeChild(e.firstElementChild)},pie.func.debounce=function(t,e,i){var r;return function(){var n=this,o=arguments,a=function(){r=null,i||t.apply(n,o)},s=i&&!r;clearTimeout(r),r=setTimeout(a,e),s&&t.apply(n,o)}},pie.func.valueFrom=function(t,e){return"function"==typeof t?t.call(e):t},pie.math.precision=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},pie.object.compact=function(t,e){var i=pie.object.extend({},t);return Object.keys(i).forEach(function(t){(void 0===i[t]||null===i[t]||e&&0===i[t].toString().length)&&delete i[t]}),i},pie.object.deepExtend=function(){function t(t){r[t]=t in r&&"object"==typeof r[t]?pie.object.deepExtend(r[t],e[t]):e[t]}for(var e,i=pie.array.args(arguments),r=i.shift();i.length;)e=i.shift(),e&&Object.keys(e).forEach(t);return r},pie.object.except=function(){var t={},e=pie.array.args(arguments),i=e[0];return e=pie.array.flatten(e.splice(1)),Object.keys(i).forEach(function(r){e.indexOf(r)<0&&(t[r]=i[r])}),t},pie.object.extend=function(){function t(t){r[t]=e[t]}for(var e,i=pie.array.args(arguments),r=i.shift();i.length;)e=i.shift(),e&&Object.keys(e).forEach(t);return r},pie.object.forEach=function(t,e){Object.keys(t).forEach(function(i){e(i,t[i])})},pie.object.getPath=function(t,e){return sudo.getPath(e,t)},pie.object.getValue=function(t,e){return"function"==typeof e?e.call(null,t):null==t?void 0:"function"==typeof t[e]?t[e].call(t):t.hasOwnProperty(e)||e in t?t[e]:void 0},pie.object.hasPath=function(t,e){for(var i,r=e.split(".");i=r.shift();){if(null==t||!t.hasOwnProperty(i))return!1;t=t[i]}return!0},pie.object.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},pie.object.serialize=function(t,e){if(!t)return"";e&&(t=pie.object.compact(t,!0));var i,r=[],n=Object.keys(t);return n=n.sort(),n.forEach(function(e){i=t[e],Array.isArray(i)?(e+="[]",i.forEach(function(t){r.push(encodeURIComponent(e)+"="+encodeURIComponent(t))})):r.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}),r.join("&")},pie.object.setPath=function(t,e,i){return sudo.setPath(e,i,t)},pie.object.slice=function(){var t={},e=1,i=arguments,r=i[0];for(Array.isArray(i[1])&&(i=i[1],e=0);e<i.length;e++)r.hasOwnProperty(i[e])&&(t[i[e]]=r[i[e]]);return t},pie.object.values=function(t){return Object.keys(t).map(function(e){return t[e]})},pie.string.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},pie.string.change=function(){var t=pie.array.args(arguments),e=t[0];return t=t.slice(1),t.forEach(function(t){e=pie.string[t](e)}),e},pie.string.deserialize=function(){function t(t){if("undefined"===t)return void 0;if("null"===t)return null;if("true"===t)return!0;if("false"===t)return!1;var e=parseFloat(t);return isNaN(e)?t:/\./.test(t)?e:parseInt(e,10)}return function(e,i){var r,n,o,a,s,p,h={},c=/^(.+)\[\]$/;return e?(r=e.indexOf("?"),~r&&(e=e.slice(r+1)),n=e.split("&"),n.forEach(function(e){o=e.split("="),s=decodeURIComponent(o[0]||""),p=decodeURIComponent(o[1]||""),i&&(p=t(p)),a=s.match(c),a?(s=a[1],h[s]=h[s]||[],h[s].push(p)):h[s]=p}),h):h}}(),pie.string.escape=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},pie.string.expand=function(t,e){return e=e||{},t.replace(/\%\{(.+?)\}/g,function(t,i){return e[i]})},pie.string.humanize=function(t){return t.replace(/_id$/,"").replace(/([a-z][A-Z]|[a-z]_[a-z])/g,function(t,e){return e[0]+" "+e[e.length-1]})},pie.string.lowerize=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},pie.string.modularize=function(t){return t.replace(/([^_])_([^_])/g,function(t,e,i){return e+i.toUpperCase()})},pie.string.pluralize=function(t){return/ss$/i.test(t)?t+"es":/s$/i.test(t)?t:/[a-z]$/i.test(t)?t+"s":t},pie.string.template=sudo.template,pie.string.titleize=function(t){return t.replace(/(^| )([a-z])/g,function(t,e,i){return e+i.toUpperCase()})},pie.string.underscore=function(t){return t.replace(/([a-z])([A-Z])/g,function(t,e,i){return e+"_"+i.toLowerCase()}).toLowerCase()},pie.string.urlConcat=function(){var t=pie.array.compact(pie.array.args(arguments),!0),e=t.shift(),i=t.join("&");return i.length?(e.indexOf("?")<0&&(e+="?"),0===i.indexOf("?")&&(i=i.replace("?","&")),e+=i,e=e.replace("?&","?").replace("&&","&").replace("??","?"),e.indexOf("?")===e.length-1&&(e=e.substr(0,e.length-1)),e):e},pie.mixins.bindings=function(){function t(t,e){var i=t.getAttribute("type");return"checkbox"===i||"radio"===i?t.checked=Array.isArray(e)?!!~e.indexOf(t.value):t.hasAttribute("value")?t.value==e:!!e:t.value=e}function e(e,i,r){for(var n=0,o=e.qsa(i);n<o.length;n++)t(o[n],r)}function i(t,e){var i,r=t.value,n=t.getAttribute("type");return"checkbox"===n||"radio"===n?Array.isArray(e)?(i=e.indexOf(r),t.checked&&!~i?(e.push(t.value),e):!t.checked&&~i?(e.splice(i,1),e):e):t.hasAttribute("value")?t.checked?t.value:null:t.checked:t.value}return{bind:function(t){t=t||{};var r=t.model||this.model,n=t.attr||t.attribute||void 0,o=t.sel||'input[name="'+n+'"]',a=(t.trigger||"keyup change").split(" "),s=t.debounce,p=!1,h=function(t){var e=i(t.delegateTarget,r.get(n));p=!0,r.set(n,e),p=!1},c=function(t){p||e(this,o,t[t.length-1].value)}.bind(this);s&&(s===!0&&(s=150),h=Function.debounce(h,s)),a.forEach(function(t){this.on(t,o,h)}.bind(this)),this.onChange(r,c,n),this._bindings=pie.array.from(this._bindings),this._bindings.push({model:r,sel:o,attr:n})},initBoundFields:function(){pie.array.from(this._bindings).forEach(function(t){e(this,t.sel,t.model.get(t.attr))}.bind(this))}}}(),pie.mixins.inheritance={_super:function(){var t,e=pie.array.args(arguments),i=e.shift(),r=this;for(1===e.length&&"[object Arguments]"===String(e[0])&&(e=pie.array.args(e[0]));;){if(t=Object.getPrototypeOf(r),!t)throw new Error("No super method defined: "+i);if(t===r)return;if(t[i]&&t[i]!==this[i])return t[i].apply(this,e);r=t}}},pie.mixins.validatable={reportValidationError:function(t,e){this.set("validationErrors."+t,e)},validates:function(t){var e,i;this.validations=this.validations||{},Object.keys(t).forEach(function(r){e=pie.array.from(t[r]),i=[],e.forEach(function(t){"string"==typeof t?i.push({type:t,options:{}}):"function"==typeof t?i.push({type:"fn",options:{fn:t}}):Object.keys(t).forEach(function(e){i.push(pie.object.isObject(t[e])?{type:e,options:t[e]}:{type:e,options:pie.object.extend({},t)})})}),this.validations[r]=this.validations[r]||[],this.validations[r]=this.validations[r].concat(i)}.bind(this))},validateAll:function(t,e,i){var r,n=!0,o=Object.keys(this.validations),a=o.length,s=0;return o.length?(r=function(t){n=!(!n||!t),s++,a===s&&(n&&e?e(!0):!n&&i&&i(!1))},void o.forEach(function(e){this.validate(t,e,r,r)}.bind(this))):void(e&&e(!0))},validate:function(t,e,i,r){var n,o,a,s=t.validator,p=pie.array.from(this.validations[e]),h=this.get(e),c=!0,u=[],l=p.length,d=0;return p.length?(a=function(t,n){c=!(!c||!n),d++,n||u.push(s.errorMessage(t.type,t.options)),d===l&&(this.reportValidationError(e,u),c&&i?i(c):!c&&r&&r(c))},void p.forEach(function(t){n=s[t.type],o=n(h,t.options,a),(o===!0||o===!1)&&a(o)})):void(i&&i(!0))}},pie.container={addChild:function(t,e){var i,r=this.children(),n=this.childNames();return r.push(e),i=r.length-1,n[t]=i,e._indexWithinParent=i,e._nameWithinParent=t,e.parent=this,"addedToParent"in e&&e.addedToParent.call(e,this),this},addChildren:function(t){pie.object.forEach(t,function(t,e){this.addChild(t,e)}.bind(this))},childNames:function(){return this._childNames=this._childNames||{}},children:function(){return this._children=this._children||[]},getChild:function(t){var e=t._nameWithinParent||t,i=this.childNames()[e];return null==i&&(i=t),~i&&this.children()[i]||void 0},send:function(){for(var t=pie.array.args(arguments),e=t.shift(),i=this.parent;i&&!(e in i);)i=i.parent;i&&i[e].apply(i,t)},removeChild:function(t){var e,i=this.getChild(t),r=this.childNames(),n=this.children();if(i){for(e=i._indexWithinParent,n.splice(e,1);e<n.length;e++)n[e]._indexWithinParent=e,r[n[e]._nameWithinParent]=e;delete r[i._nameWithinParent],delete i._indexWithinParent,delete i._nameWithinParent,delete i.parent,"removedFromParent"in i&&i.removedFromParent.call(i,this)}return this},removeChildren:function(){for(var t,e=this.children();t=e[e.length-1];)this.removeChild(t);return this}},pie.model=function(t,e){this.data=pie.object.extend({},t),this.options=e||{},this.uid=pie.unique(),this.observations={},this.changeRecords=[]},pie.object.extend(pie.model.prototype,pie.mixins.inheritance),pie.model.prototype.deliverChangeRecords=function(){for(var t,e,i,r={};i=this.changeRecords.shift();)for(t=pie.array.union(this.observations[i.name],this.observations.__all__);e=t.shift();)r[e.uid]=r[e.uid]||{fn:e,changes:[]},r[e.uid].changes.push(i);return pie.object.forEach(r,function(t,e){e.fn.call(null,e.changes)}),this},pie.model.prototype.get=function(t){return pie.object.getPath(this.data,t)},pie.model.prototype.gets=function(){var t=pie.array.args(arguments),e={};return t=pie.array.flatten(t),t=pie.array.compact(t),t.forEach(function(t){e[t]=pie.object.getPath(this.data,t)}.bind(this)),pie.object.compact(e)},pie.model.prototype.observe=function(){var t=pie.array.args(arguments),e=t.shift();return e.uid=e.uid||String(pie.unique()),t=pie.array.flatten(t),t.length||t.push("__all__"),t.forEach(function(t){this.observations[t]=this.observations[t]||[],this.observations[t].indexOf(e)<0&&this.observations[t].push(e)}.bind(this)),this},pie.model.prototype.set=function(t,e,i){var r={name:t,object:this.data};return pie.object.hasPath(this.data,t)?(r.type="update",r.oldValue=pie.object.getPath(this.data,t)):r.type="add",r.value=e,pie.object.setPath(this.data,t,e),this.changeRecords.push(r),i?this:this.deliverChangeRecords()},pie.model.prototype.sets=function(t,e){return pie.object.forEach(t,function(t,e){this.set(t,e,!0)}.bind(this)),e?this:this.deliverChangeRecords()},pie.model.prototype.unobserve=function(){var t,e=pie.array.args(arguments),i=e.shift();return e.length||(e=Object.keys(this.observations)),e.forEach(function(e){t=this.observations[e].indexOf(i),~t&&this.observations[e].splice(t,1)}.bind(this)),this},pie.model.prototype.compute=function(){var t=pie.array.args(arguments),e=t.shift(),i=t.shift();this.observe(function(){this.set(e,i.call(this))}.bind(this),t),this.set(e,i.call(this))},pie.list=function(t,e){t=t||[],pie.model.call(this,{items:t},e)},pie.list.prototype=Object.create(pie.model.prototype),pie.list.prototype._normalizedIndex=function(t){return t=parseInt(t,10),!isNaN(t)&&0>t&&(t+=this.data.items.length),t},pie.list.prototype._trackMutations=function(t,e){var i=this.data.items.length,r=[e.call()],n=this.data.items.length;return i!==n&&r.push({name:"length",type:"update",object:this.data.items,oldValue:i,value:n}),this.changeRecords=this.changeRecords.concat(r),t?this:this.deliverChangeRecords()},pie.list.prototype.forEach=function(t){return this.get("items").forEach(t)},pie.list.prototype.get=function(t){var e,i=this._normalizedIndex(t);return e=isNaN(i)?t:"items."+i,this._super("get",e)},pie.list.prototype.indexOf=function(t){return this.get("items").indexOf(t)},pie.list.prototype.insert=function(t,e,i){var r=this._normalizedIndex(t);return this._trackMutations(i,function(){var t={name:String(r),object:this.data.items,type:"add",oldValue:this.data.items[r],value:e};return this.data.items.splice(r,0,e),t}.bind(this))},pie.list.prototype.length=function(){return this.get("items.length")},pie.list.prototype.push=function(t,e){return this._trackMutations(e,function(){var e={name:String(this.data.items.length),object:this.data.items,type:"add",value:t,oldValue:void 0};return this.data.items.push(t),e}.bind(this))},pie.list.prototype.remove=function(t,e){var i=this._normalizedIndex(t);return this._trackMutations(e,function(){var t={name:String(i),object:this.data.items,type:"delete",oldValue:this.data.items[i],value:void 0};return this.data.items.splice(i,1),t}.bind(this))},pie.list.prototype.set=function(t,e,i){var r=this._normalizedIndex(t);return isNaN(r)?this._super("set",t,e,i):this._trackMutations(i,function(){var t={name:String(r),object:this.data.items,type:"update",oldValue:this.data.items[r]};return this.data.items[r]=t.value=e,t}.bind(this))},pie.list.prototype.shift=function(t){return this._trackMutations(t,function(){var t={name:"0",object:this.data.items,type:"delete"};return t.oldValue=this.data.items.shift(),t.value=this.data.items[0],t}.bind(this))},pie.list.prototype.unshift=function(t,e){return this.insert(0,t,e)},pie.view=function(t,e){this.app=t,this.options=e||{},this.el=this.options.el||pie.dom.createElement("<div />"),this.uid=pie.unique(),this.changeCallbacks=[]},pie.object.extend(pie.view.prototype,pie.mixins.inheritance),pie.object.extend(pie.view.prototype,pie.container),pie.object.extend(pie.view.prototype,pie.mixins.bindings),pie.view.prototype.addedToParent=function(){return this},pie.view.prototype.eventNamespace=function(){return"view"+this.uid},pie.view.prototype.loadingStyle=function(t){void 0===t&&(t=!0),this._loadingStyle(t)},pie.view.prototype.navigationUpdated=function(){this.children().forEach(function(t){"navigationUpdated"in t&&t.navigationUpdated()})},pie.view.prototype.on=function(t,e,i){var r=this.eventNamespace(),n=function(t){return t.namespace===r?i.apply(this,arguments):void 0};return t.split(" ").forEach(function(t){t+="."+r,$(this.el).on(t,n,e)}.bind(this)),this},pie.view.prototype.onChange=function(){var t=arguments[0],e=pie.array.args(arguments).slice(1);if(!("observe"in t))throw new Error("Observable does not respond to observe");this.changeCallbacks.push([t,e]),t.observe.apply(t,e)},pie.view.prototype.parseFields=function(){var t,e,i={},r=arguments[0],n=0;for("string"==typeof r?r=this.el:n++;n<arguments.length;n++)t=arguments[n],e=r.querySelector('[name="'+t+'"]:not([disabled])'),e&&pie.object.setPath(i,t,e.value);return i},pie.view.prototype.qs=function(t){return this.el.querySelector(t)},pie.view.prototype.qsa=function(t){return this.el.querySelectorAll(t)},pie.view.prototype.removedFromParent=function(){return this._unobserveEvents(),this._unobserveChangeCallbacks(),this.removeChildren(),this},pie.view.prototype.removeLoadingStyle=function(){this._loadingStyle(!1)},pie.view.prototype._unobserveEvents=function(){$(this.el).off("*."+this.eventNamespace()),$(document.body).off("*."+this.eventNamespace())},pie.view.prototype._unobserveChangeCallbacks=function(){for(var t;this.changeCallbacks.length;)t=this.changeCallbacks.pop(),t[0].unobserve.apply(t[0],t[1])},pie.view.prototype._loadingStyle=function(t){this.el.classList[t?"add":"remove"]("loading"),$(this.qsa(".submit-container button.btn-primary, .btn-loading, .btn-loadable")).all(t?"classList.add":"classList.remove","btn-loading").all(t?"setAttribute":"removeAttribute","disabled","disabled")},pie.simpleView=function(t,e){pie.view.call(this,t,e)},pie.simpleView.prototype=Object.create(pie.view.prototype),pie.simpleView.prototype.constructor=pie.simpleView,pie.simpleView.prototype.addedToParent=function(t){if(pie.view.prototype.addedToParent.call(this,t),this.options.autoRender&&this.model){var e="string"==typeof this.options.autoRender?this.options.autoRender:"updated_at";this.onChange(this.model,this.render.bind(this),e)}return this.options.renderOnAddedToParent&&this.render(),this},pie.simpleView.prototype.removedFromParent=function(t){pie.view.prototype.removedFromParent.call(this,t),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},pie.simpleView.prototype.renderData=function(){return this.model?this.model.data:{}},pie.simpleView.prototype.render=function(){if(this.options.template){var t=this.app.template(this.options.template,this.renderData());this.el.innerHTML=t}return this},pie.validator=function(t){this.app=t,this.i18n=t.i18n},pie.validator.rangeOptions=function(t,e){this.i18n=t.i18n,this.rangedata=e||{},this.rangedata.rangedata&&(this.rangedata=this.rangedata.rangedata)},pie.validator.rangeOptions.prototype.get=function(t){return pie.func.valueFrom(this.rangedata[t])},pie.validator.rangeOptions.prototype.has=function(t){return!!(t in this.rangedata)},pie.validator.rangeOptions.prototype.t=function(t,e){return this.i18n.t("app.validations.range_messages."+t,e)},pie.validator.rangeOptions.prototype.matches=function(t){var e=!0;return e=e&&(!this.has("gt")||t>this.get("gt")),e=e&&(!this.has("lt")||t<this.get("lt")),e=e&&(!this.has("gte")||t>=this.get("gte")),e=e&&(!this.has("lte")||t<=this.get("lte")),e=e&&(!this.has("eq")||t===this.get("eq"))},pie.validator.rangeOptions.prototype.message=function(){if(this.has("eq"))return this.t("eq",{count:this.get("eq")});var t=["",""];return this.has("gt")?t[0]+=this.t("gt",{count:this.get("gt")}):this.has("gte")&&(t[0]+=this.t("gte",{count:this.get("gte")})),this.has("lt")?t[1]+=this.t("lt",{count:this.get("lt")}):this.has("lte")&&(t[1]+=this.t("lte",{count:this.get("lte")})),pie.array.toSentence(pie.array.compact(t,!0),this.i18n).trim()},pie.validator.prototype.errorMessage=function(t,e){if(e.message)return e.message;var i=this.i18n.t("app.validations."+t),r=new pie.validator.rangeOptions(this.app,e),n=r.message();return n||"length"!==t||(r=new pie.validator.rangeOptions(this.app,{gt:0}),n=r.message()),(i+" "+n).trim()},pie.validator.prototype.withStandardChecks=function(t,e,i){return e=e||{},e.allowBlank&&!this.presence(t)?!0:e.unless&&e.unless.call()?!0:e["if"]&&!e["if"].call()?!0:i.call()},pie.validator.prototype.cc=function(t,e){return this.withStandardChecks(t,e,function(){var e=String(t).replace(/[^a-zA-Z0-9]/g,"");return this.number(e)&&this.length(e,{gte:15,lte:16})}.bind(this))},pie.validator.prototype.chosen=function(t,e){return this.presence(t,e)},pie.validator.prototype.cvv=function(t,e){return this.withStandardChecks(t,e,function(){return this.number(t)&&this.length(t,{gte:3,lte:4})}.bind(this))},pie.validator.prototype.date=function(t,e){return e=e||{},this.withStandardChecks(t,e,function(){var i,r=t.split("-"),n=r[0],o=r[1],a=r[2];if(!n||!o||!a)return!1;if(!this.length(n,{eq:4})&&this.length(o,{eq:2})&&this.length(a,{eq:2}))return!1;e.sanitized||(Object.keys(e).forEach(function(t){i=e[t],i=i.getFullYear()+"-"+(i.getMonth()<9?"0":"")+(i.getMonth()+1)+"-"+(i.getDate()<10?"0":"")+i.getDate(),e[t]=i}),e.sanitized=!0);var s=new pie.validator.rangeOptions(this.app,e);return s.matches(t)}.bind(this))},pie.validator.prototype.email=function(t,e){return e=pie.object.extend({allowBlank:!1},e||{}),this.withStandardChecks(t,e,function(){return/^.+@.+\..+$/.test(t)})},pie.validator.prototype.fn=function(t,e,i){return this.withStandardChecks(t,e,function(){return e.fn.call(null,t,e,i)})},pie.validator.prototype.format=function(t,e){return e=e||{},this.withStandardChecks(t,e,function(){var i=e.format||e["with"];return"isoDate"===i?i=/^\d{4}\-\d{2}\-\d{2}$/:"epochs"===i?i=/^\d{10}$/:"epochms"===i&&(i=/^\d{13}$/),!!i.test(String(t))})},pie.validator.prototype.integer=function(t,e){return this.withStandardChecks(t,e,function(){return this.number(t,e)&&parseInt(t,10)===parseFloat(t,10)}.bind(this))},pie.validator.prototype.length=function(t,e){return e=pie.object.extend({allowBlank:!1},e),"gt"in e||"gte"in e||"lt"in e||"lte"in e||"eq"in e||(e.gt=0),this.withStandardChecks(t,e,function(){var i=String(t).trim().length;return this.number(i,e)}.bind(this))},pie.validator.prototype.number=function(t,e){return e=e||{},this.withStandardChecks(t,e,function(){if(!/^([\-])?([\d]+)?\.?[\d]+$/.test(String(t)))return!1;var i=parseFloat(t),r=new pie.validator.rangeOptions(this.app,e);return r.matches(i)})},pie.validator.prototype.phone=function(t,e){return e=pie.object.extend({allowBlank:!1},e||{}),this.withStandardChecks(t,e,function(){var e=String(t).replace(/[^\+\d]+/g,"");return this.length(e,{gte:10})}.bind(this))},pie.validator.prototype.presence=function(t,e){return this.withStandardChecks(t,pie.object.extend({},e,{allowBlank:!1}),function(){return!(!t||!/[^ ]/.test(String(t)))})},pie.validator.prototype.url=function(t,e){return this.withStandardChecks(t,e,function(){return/^.+\..+$/.test(t)})},pie.services.ajax=function(t){this.app=t,this.defaultAjaxOptions={}},pie.services.ajax.prototype._defaultAjaxOptions=function(){return pie.object.extend({},this.defaultAjaxOptions,{dataType:"json",type:"GET",error:this.app.errorHandler.handleXhrError})},pie.services.ajax.prototype.ajax=function(t){if(t=pie.object.compact(t),t=pie.object.extend({},this._defaultAjaxOptions(),t),t.extraError){var e=t.error;t.error=function(i){e(i),t.extraError(i)}}var i,r=this.app,n=new XMLHttpRequest,o=t.url;return o="GET"===t.type&&t.data?r.router.path(o,t.data):r.router.path(o),t.progress?n.addEventListener("progress",t.progress,!1):t.uploadProgress&&n.upload.addEventListener("progress",t.uploadProgress,!1),n.open(t.type,o,!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),this._applyCsrfToken(n),n.onload=function(){t.tracker&&t.tracker(this);try{this.data=this.responseText.trim().length?JSON.parse(this.responseText):{}}catch(e){r.debug("could not parse JSON response: "+e),this.data={}}this.status>=200&&this.status<300||304===this.status?(t.dataSuccess&&t.dataSuccess(this.data),t.success&&t.success(this.data,this)):t.error&&t.error(this),t.complete&&t.complete(this)},"GET"!==t.type&&(i=t.data?"string"==typeof t.data?t.data:JSON.stringify(pie.object.compact(t.data)):void 0),n.send(i),n},pie.services.ajax.prototype.get=function(t){return t=pie.object.extend({type:"GET"},t),this.ajax(t)},pie.services.ajax.prototype.post=function(t){return t=pie.object.extend({type:"POST"},t),this.ajax(t)},pie.services.ajax.prototype.put=function(t){return t=pie.object.extend({type:"PUT"},t),this.ajax(t)},pie.services.ajax.prototype.del=function(t){return t=pie.object.extend({type:"DELETE"},t),this.ajax(t)},pie.services.ajax.prototype._applyCsrfToken=function(t){var e=document.querySelector('meta[name="csrf-token"]'),i=e?e.getAttribute("content"):null;i&&t.setRequestHeader("X-CSRF-Token",i)},pie.services.errorHandler=function(t){this.app=t,this.responseCodeHandlers={}},pie.services.errorHandler.prototype.data=function(t){return t.data=t.data||(t.status?JSON.parse(t.response):{})},pie.services.errorHandler.prototype.errorMessagesFromRequest=function(t){var e,i=this.data(t),r=pie.array.map(i.errors||[],"message");return r=pie.array.compact(r,!0),e=this.app.i18n.t("app.errors."+t.status,{"default":r}),this.app.debug(r),pie.array.from(e)},pie.services.errorHandler.prototype.handleXhrError=function(t){var e=this.responseCodeHandlers[t.status.toString()];e?e.call(t,t):this.notifyErrors(t)},pie.services.errorHandler.prototype.notifyErrors=function(t){var e=this.app.notifier,i=this.errorMessagesFromRequest(t);i.length&&(e.clear(),setTimeout(function(){e.clear("error"),e.notify(i,"error",1e4)},100))},pie.services.errorHandler.prototype.registerHandler=function(t,e){this.responseCodeHandlers[t.toString()]=e},pie.services.errorHandler.prototype.reportError=function(t,e){e=e||{},e.prefix&&"message"in t&&(t.message=e.prefix+" "+t.message),e.prefix&&"name"in t&&(t.name=e.prefix+" "+t.name),this._reportError(t,e)},pie.services.errorHandler.prototype._reportError=function(t){this.app.debug(t)},pie.services.i18n=function(t){this.translations={},this.app=t},pie.services.i18n.prototype._ampm=function(t){return t>=12?"pm":"am"},pie.services.i18n.prototype._countAlias={0:"zero",1:"one","-1":"negone"},pie.services.i18n.prototype._dayName=function(t){return this.t("app.time.day_names."+t)},pie.services.i18n.prototype._hour=function(t){return t>12&&(t-=12),t||(t+=12),t},pie.services.i18n.prototype._isoDate=function(t,e){return e&&(t=this._utc(t)),t.getFullYear()+"-"+this._pad(t.getMonth()+1,2,"0")+"-"+this._pad(t.getDate(),2,"0")},pie.services.i18n.prototype._isoTime=function(t){return t=this._utc(t),this._pad(t.getHours(),2,"0")+":"+this._pad(t.getMinutes(),2,"0")+":"+this._pad(t.getSeconds(),2,"0")+"."+this._pad(t.getMilliseconds(),3,"0")+"Z"},pie.services.i18n.prototype._monthName=function(t){return this.t("app.time.month_names."+t)},pie.services.i18n.prototype._nestedTranslate=function(t,e){return t.replace(/\$\{([^\}]+)\}/,function(t,i){return this.translate(i,e)}.bind(this))},pie.services.i18n.prototype._normalizedDate=function(t){return String(t).match(/^\d+$/)?(t=parseInt(t,10),String(t).length<13&&(t*=1e3),t=new Date(t)):t="string"==typeof t?pie.date.timeFromISO(t):new Date(t),t},pie.services.i18n.prototype._shortDayName=function(t){return this.t("app.time.short_day_names."+t)||this._dayName(t).slice(0,3)},pie.services.i18n.prototype._shortMonthName=function(t){return this.t("app.time.short_month_names."+t)||this._monthName(t).slice(0,3)},pie.services.i18n.prototype._pad=function(t,e,i){var r="",n=e-t.toString().length;for(void 0===i&&(i=" ");n>0;)r+=i,n-=1;return r+t.toString()},pie.services.i18n.prototype._timezoneAbbr=function(t){var e=t&&t.toString();return e&&e.split(/\((.*)\)/)[1]},pie.services.i18n.prototype._utc=function(t){var e=new Date(t.getTime());return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e},pie.services.i18n.prototype.load=function(t,e){var i=e?pie.object.extend:pie.object.deepExtend;i.call(null,this.translations,t)},pie.services.i18n.prototype.translate=function(t,e){var i,r=pie.object.getPath(this.translations,t);if(e&&e.hasOwnProperty("count")&&"object"==typeof r&&(i=(e.count||0).toString(),i=this._countAlias[i]||(i>0?"other":"negother"),r=void 0===r[i]?r.other:r[i]),!r){if(!e||!e.hasOwnProperty("default"))return this.app.debug("Translation not found: "+t),"";r=e.default}return"string"==typeof r?(r=-1===r.indexOf("${")?r:this._nestedTranslate(r,e),-1===r.indexOf("%{")?r:pie.string.expand(r,e)):r},pie.services.i18n.prototype.timeago=function(t,e,i){t=this._normalizedDate(t).getTime()/1e3,e=this._normalizedDate(e||new Date).getTime()/1e3;var r,n=e-t;return i=i||"app",60>n?this.t(i+".timeago.now",{count:n}):3600>n?(r=Math.floor(n/60),this.t(i+".timeago.minutes",{count:r})):86400>n?(r=Math.floor(n/3600),this.t(i+".timeago.hours",{count:r})):604800>n?(r=Math.floor(n/86400),this.t(i+".timeago.days",{count:r})):2592e3>n?(r=Math.floor(n/604800),this.t(i+".timeago.weeks",{count:r})):31594125>n?(r=Math.floor(n/2629800),this.t(i+".timeago.months",{count:r})):(r=Math.floor(n/31557600),this.t(i+".timeago.years",{count:r}))},pie.services.i18n.prototype.strftime=function(t,e){t=this._normalizedDate(t),e&&"%"!==e.charAt(0)&&(e=this.t("app.time.formats."+e));var i=t.getDay(),r=t.getDate(),n=t.getFullYear(),o=t.getMonth()+1,a=t.getHours(),s=this._hour(a),p=this._ampm(a),h=t.getSeconds(),c=t.getMinutes(),u=t.getTimezoneOffset(),l=Math.floor(Math.abs(u/60)),d=Math.abs(u)-60*l,f=(u>0?"-":"+")+this._pad(l,2,"0")+this._pad(d,2,"0");return e=e.replace("%a",this._shortDayName(i)).replace("%A",this._dayName(i)).replace("%b",this._shortMonthName(o-1)).replace("%d",this._pad(r,2,"0")).replace("%e",this._pad(r,2," ")).replace("%-d",r).replace("%H",this._pad(a,2,"0")).replace("%k",a).replace("%I",this._pad(s,2,"0")).replace("%l",s).replace("%m",this._pad(o,2,"0")).replace("%-m",o).replace("%M",this._pad(c,2,"0")).replace("%p",p.toUpperCase()).replace("%P",p).replace("%S",this._pad(h,2,"0")).replace("%-S",h).replace("%w",i).replace("%y",this._pad(n%100)).replace("%Y",n).replace("%z",f).replace("%Z",this._timezoneAbbr(t))},pie.services.i18n.prototype.t=pie.services.i18n.prototype.translate,pie.services.i18n.prototype.l=pie.services.i18n.prototype.strftime,pie.services.navigator=function(t){this.app=t,pie.model.prototype.constructor.call(this,{})},pie.services.navigator.prototype=Object.create(pie.model.prototype),pie.services.navigator.prototype.go=function(t,e,i){var r=t;return e=e||{},this.get("path")===t&&this.get("query")===e?this:(Object.keys(e).length&&(r+="?",r+=$.serialize(e)),window.history[i?"replaceState":"pushState"]({},document.title,r),this.setDataFromLocation())},pie.services.navigator.prototype.start=function(){return this.setDataFromLocation()},pie.services.navigator.prototype.setDataFromLocation=function(){var t=window.location.search.slice(1);return t=pie.string.deserialize(t),this.sets({url:window.location.href,path:window.location.pathname,query:t}),this},pie.services.notifier=function(t){pie.view.prototype.constructor.call(this),this.app=t,this.notifications={}},pie.services.notifier.prototype=Object.create(pie.view.prototype),pie.services.notifier.prototype.addedToParent=function(){this.on("click",".page-alert",this.handleAlertClick.bind(this))},pie.services.notifier.prototype.clear=function(t){if(t)for(var e=this.notifications[t]||[];e.length;)this.remove(e[e.length-1]);else for(;this.el.childNodes.length;)this.remove(this.el.childNodes[0])},pie.services.notifier.prototype.notify=function(t,e,i){e=e||"message",i=this.getAutoCloseTimeout(i),t=pie.array.from(t);
var r=this.app.template("alert",{type:e,messages:t});r=pie.dom.createElement(r),this.notifications[e]=this.notifications[e]||[],this.notifications[e].push(r),r._pieNotificationType=e,this.el.insertBefore(r,this.el.firstElementChild),i&&setTimeout(function(){this.remove(r)}.bind(this),i)},pie.services.notifier.prototype.getAutoCloseTimeout=function(t){return void 0===t&&(t=!0),t&&"number"!=typeof t&&(t=7e3),t},pie.services.notifier.prototype.remove=function(t){var e=t._pieNotificationType;e&&pie.array.remove(this.notifications[e]||[],t),$(t).remove()},pie.services.notifier.prototype.handleAlertClick=function(t){this.remove(t.delegateTarget),t.preventDefault()},pie.services.router=function(t){this.app=t,this.routes={},this.namedRoutes={}},pie.services.router.prototype.changedUrl=function(t){var e=this.app.parsedUrl;return this.router.path(e.name||e.path,pie.object.extend({},e.interpolations,e.query,t))},pie.services.router.prototype.normalizePath=function(t){if("/"!==t.charAt(0)&&(t="/"+t),t.indexOf("?")>0){var e=t.split("?");t=this.normalizePath(e.shift()),e.unshift(t),t=e.join("?")}return"#"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),"/"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),t},pie.services.router.prototype.route=function(t,e){e=e||{},delete this._routeKeys,pie.object.forEach(t,function(t,i){"object"==typeof i?(t=this.normalizePath(t),this.routes[t]=pie.object.extend({},e,i),i.hasOwnProperty("name")&&(this.namedRoutes[i.name]=t)):this.namedRoutes[t]=i}.bind(this))},pie.services.router.prototype.path=function(t,e,i){var r,n,o=this.namedRoutes[t],a="string"==typeof o?o:t,s=[];return e=e||{},a=this.normalizePath(a),a=a.replace(/\:([a-zA-Z0-9_]+)/g,function(t,i){if(s.push(i),void 0===e[i]||null===e[i]||0===e[i].toString().length)throw new Error("[PIE] missing route interpolation: "+t);return e[i]}),n=pie.object.except(e,s),r=pie.object.serialize(pie.object.compact(n,!0)),!i&&r.length&&(a=pie.string.urlConcat(a,r)),a},pie.services.router.prototype.routeKeys=function(){if(this._routeKeys)return this._routeKeys;this._routeKeys=Object.keys(this.routes);var t,e,i,r=[];return this._routeKeys.sort(function(n,o){return t=(n.match(/:/g)||r).length,e=(o.match(/:/g)||r).length,i=t-e,i=i||o.length-n.length,i=i||(e>t?1:t>e?-1:0)}),this._routeKeys},pie.services.router.prototype.parseUrl=function(t){var e,i,r,n,o,a,s,p,h,c=this.routeKeys(),u=0;if(h=t.split("?"),t=h.shift(),t=this.normalizePath(t),a=h.join("&")||"",t.length>1&&"/"===t[t.length-1]&&(t=t.slice(0,-1)),r=this.routes[t],s={},n=t.split("/"),r)r=pie.object.extend({routeKey:t},r);else for(;u<c.length&&!r;)if(i=c[u],"object"==typeof this.routes[i]){if(this.routes[i].regex=this.routes[i].regex||new RegExp("^"+i.replace(/(:[^\/]+)/g,"([^\\/]+)")+"$"),this.routes[i].regex.test(t))for(r=pie.object.extend({routeKey:i},this.routes[i]),o=i.split("/"),e=0;e<o.length;e++)/^:/.test(o[e])&&(s[o[e].replace(/^:/,"")]=n[e],r[o[e]]=n[e]);u++}else u++;return a=pie.string.deserialize(a),p=pie.array.compact([t,pie.object.serialize(a)],!0).join("?"),pie.object.extend({interpolations:s,path:t,query:a,fullPath:p},r)},pie.app=function(t){this.options=pie.object.deepExtend({uiTarget:"body",viewNamespace:"lib.views",notificationUiTarget:".notification-container"},t);var e=function(t,e){var i=this.options[t]||e;return new i(this)}.bind(this);this.i18n=e("i18n",pie.services.i18n),this.addChild("i18n",this.i18n),this.ajax=e("ajax",pie.services.ajax),this.addChild("ajax",this.ajax),this.notifier=e("notifier",pie.services.notifier),this.addChild("notifier",this.notifier),this.errorHandler=e("errorHandler",pie.services.errorHandler),this.addChild("errorHandler",this.errorHandler),this.router=e("router",pie.services.router),this.addChild("router",this.router),this.navigator=e("navigator",pie.services.navigator),this.addChild("navigator",this.navigator),this.validator=e("validator",pie.validator),this.addChild("validator",this.validator),this.models={},this._templates={},this.parsedUrl={},this.eventCallbacks={},this.triggeredEvents=[],this.navigator.observe(this.navigationChanged.bind(this),"url"),this.on("beforeStart",this.showStoredNotifications.bind(this)),this.on("beforeStart",this.setupSinglePageLinks.bind(this)),this.on("beforeStart",this.setupNotifier.bind(this)),document.addEventListener("DOMContentLoaded",this.start.bind(this)),window.pieInstance=window.pieInstance||this},pie.object.extend(pie.app.prototype,pie.container),pie.app.prototype.confirm=function(t){window.confirm(t.text)?t.success&&t.success():t.failure&&t.failure()},pie.app.prototype.debug=function(t){"production"!==this.env&&console&&console.log&&console.log("[PIE] "+t)},pie.app.prototype.go=function(){var t,e,i,r,n=pie.array.args(arguments);t=n.shift(),"string"==typeof n[0]&&0===n[0].indexOf("?")?(t=this.router.path(t),r=n.shift(),t=pie.string.urlConcat(this.router.path(t),r)):t="object"==typeof n[0]?this.router.path(t,n.shift()):this.router.path.apply(this.router,pie.array.from(t)),(n[0]===!0||n[0]===!1)&&(i=n.shift()),e=n,this.router.parseUrl(t).hasOwnProperty("view")?(this.navigator.go(t,i),e&&e.length&&this.notifier.notify.apply(this.notifier,e)):(e&&e.length&&this.store(this.notifier.storageKey,e),window.location.href=t)},pie.app.prototype.goBack=function(){window.history.back()},pie.app.prototype.handleSinglePageLinkClick=function(t){if(!t.delegateTarget.getAttribute("target")&&!t.ctrlKey&&!t.metaKey){var e=t.delegateTarget.getAttribute("href");e&&!/^(#|[a-z]+:\/\/)/.test(e)&&("?"===e.charAt(0)&&(e=window.location.pathname+e),t.preventDefault(),this.go(e))}},pie.app.prototype.navigationChanged=function(){var t=document.querySelector(this.options.uiTarget),e=this.getChild("currentView");if(this.previousUrl=this.parsedUrl,this.parsedUrl=this.router.parseUrl(this.navigator.get("path")),this.previousUrl!==this.parsedUrl&&this.trigger("urlChanged"),this.parsedUrl.view){if(e&&e._pieName===this.parsedUrl.view)return void("navigationUpdated"in e&&e.navigationUpdated());e&&(this.removeChild(e),e.el.parentNode&&e.el.parentNode.removeChild(e.el),this.on("oldViewRemoved")),this.notifier.clear();var i,r=pie.object.getPath(window,this.options.viewNamespace+"."+this.parsedUrl.view);i=new r(this),i._pieName=this.parsedUrl.view,this.addChild("currentView",i),t.appendChild(i.el),this.models={},window.scrollTo(0,0),this.trigger("newViewLoaded")}},pie.app.prototype.on=function(t,e,i){!i&&~this.triggeredEvents.indexOf(t)?e():(this.eventCallbacks[t]=this.eventCallbacks[t]||[],this.eventCallbacks[t].push(e))},pie.app.prototype.refresh=function(){var t=this.getChild("currentView");t._pieName="__remove__",this.navigationChanged()},pie.app.prototype.retrieve=function(t,e){var i,r;try{i=window.localStorage.getItem(t),r=i?JSON.parse(i):void 0}catch(n){this.errorHandler.reportError(n,{prefix:"[caught] app#retrieve/getItem:"})}try{(e||void 0===e)&&window.localStorage.removeItem(t)}catch(n){this.errorHandler.reportError(n,{prefix:"[caught] app#retrieve/removeItem:"})}return r},pie.app.prototype.setupNotifier=function(){var t=document.querySelector(this.options.notificationUiTarget);t&&t.appendChild(this.getChild("notifier").el)},pie.app.prototype.setupSinglePageLinks=function(){$(document.body).on("click",this.handleSinglePageLinkClick.bind(this),"a[href]")},pie.app.prototype.showStoredNotifications=function(){var t,e=this.retrieve(this.notifier.storageKey);e&&(t=JSON.parse(e),this.on("afterStart",function(){this.notifier.notify.apply(this.notifier,t)}.bind(this)))},pie.app.prototype.start=function(){this.navigator.start(),this.trigger("beforeStart");var t=this.navigator.get("url");this.navigator.data.url=null,this.navigator.set("url",t),this.started=!0,this.trigger("afterStart")},pie.app.prototype.store=function(t,e){try{window.localStorage.setItem(t,JSON.stringify(e))}catch(i){this.errorHandler.reportError(i,{prefix:"[caught] app#store:"})}},pie.app.prototype.template=function(t,e){if(!this._templates[t]){var i=document.querySelector('script[id="'+t+'"][type="text/pie-template"]');if(!i)throw new Error("[PIE] Unknown template error: "+t);this.debug("Compiling and storing template: "+t),this._templates[t]=pie.string.template(i.textContent)}return e=e||{},this._templates[t](e)},pie.app.prototype.trigger=function(t){this.triggeredEvents.indexOf(t)<0&&this.triggeredEvents.push(t),(this.eventCallbacks[t]||[]).forEach(function(t){t()})};